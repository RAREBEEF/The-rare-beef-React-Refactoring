# **The rare beef React refactoring**
이전에 로고 제작 기념으로 만든 The rare beef 사이트를 React로 리팩토링 해보았다. 

사실 리팩토링보다는 처음부터 다시 만들었다는 말이 더 잘 어울린다. 아예 새로운 프로젝트를 파서 기존 코드의 인용 없이 다시 만들었기 때문이다.

[리팩토링 버전](https://therarebeef.netlify.app/)  
[기존 버전](https://rarebeef.netlify.app/)

<br />

# **기존 버전과의 차이점**

## **최초 로딩**
### **기존 버전**
기존의 버전은 페이지가 로딩될 때 각각의 요소가 하나하나 로드되며 페이지가 완성되었다.

여기서 문제는 각 요소가 스타일이 입혀진 상태로 로드되는 것이 아닌 일단 로드된 후에 스타일이 입혀지는 것이었는데 굉장히 난잡해보였다.

### **리팩토링 버전**
React로 만들었기 때문에 기본적으로 ssr 이라는 특징을 갖고 있고, 페이지의 요소들이 완전히 정돈된 상태로 브라우저에 출력된다. 

기존 버전의 로딩이 너무 난잡했기 때문에 개선점이라고 생각된다.

<br />


## **애니메이션 추가**
1. 스위치가 좌우로 흔들리는 애니메이션을 추가하여 기존 버전에서 낮았던 스위치의 존재감을 향상시켰다.

2. 스위치 클릭 시 당겼다가 놓는 듯한 효과를 주기 위해 최저지점에서 잠시 머물렀다가 빠르게 복귀하도록 하였다.

3. 로고 이미지 클릭 시 떠오르는 효과에 반동을 주었다.

<br />


## **열쇠 말풍선 추가**
### **기존 버전**
기존의 버전은 열쇠를 클릭 시 곧바로 내 Github 페이지로 링크가 연결되었다.

### **리팩토링 버전**
열쇠를 클릭할 시 말풍선이 나와서 Velog와 Github으로 이동 가능한 버튼을 보여주도록 만들었다.

<br />


## **코드 개선**
### **기존 버전**
기존 버전은 거의 모든 애니메이션을 JS의 gsap으로 처리했고 그로 인해서 스크립트가 무거워지는 문제가 있었다.

스위치의 경우 클릭 시 사운드 재생, 스위치 애니메이션, 네온 점멸 효과, 클래스 부여 등 많은 작업이 동시에 처리되기 때문에 이전 동작이 완료되기 전에 반복적으로 클릭할 경우 문제가 발생하는 경우가 많았다. 

또한 스위치가 한 번 동작한 이후에 브라우저의 크기를 변경할 경우 스위치가 사라지거나 애니메이션 효과에 문제가 발생했다. gsap의 문제로 예상되었다.

따라서 스위치에 throttle을 부여하여 반복 클릭을 제한하고 window 리사이즈 이벤트를 모니터링하여 윈도우 크기가 변하면 스위치의 위치를 (원래 있어야 할 위치로)재조정하는 불필요한 작업이 요구되었다.

<br />


### **리팩토링 버전**
리팩토링 버전에서는 모든 애니메이션을 css만으로 처리하였다. 

특히 스위치의 경우 gsap을 사용하지 않았기 때문에 window 리사이즈 이슈도 해결되었고 클릭 시 JS에서 처리할 작업이 상당 부분 줄어서 반복적인 클릭에도 별다른 이슈가 발생하지 않았다.

한 가지 아쉬웠던 부분은 text-shodow 의 퍼포먼스 이슈였는데, 이는 기존 버전에서도 마찬가지였지만 네온 효과를 위해 어쩔 수 없이 해결을 포기한 문제였다.

<br />


### **text-shadow 퍼포먼스 이슈**
text-shadow의 처리는 리소스가 많이 요구된다. 필요한 리소스는 효과가 중첩될 수록 엄청나게 증가한다. 

이 웹사이트는 네온 효과를 위해 text-shadow가 4번 중첩된다. 심지어 효과가 입혀진 채로 페이지가 로드되는 것이 아닌 사용자의 상호작용에 의해 효과가 실시간으로 적용되며 깜빡이는 효과를 위해 네온이 완전히 켜지기까지 여러차례 적용/해제가 반복된다.

이와 동시에 스위치의 애니메이션, 사운드 재생 등이 이루어진다. 이 부분에서 text-shadow로 인해 애니메이션이 끊기거나 사운드에 딜레이가 걸리는 문제가 발생한다.

알 수 없는 이유에서 기존 버전보다 리팩토링 버전에서 text-shadow의 성능 저하가 심각했다. 문제 해결을 위해 여러 방법을 찾아보고 시도해보았지만 큰 차이는 없었다. 

결국 네온이 깜빡거리는 부분에서 효과의 중첩을 줄이기로 결정을 내렸다. 네온이 완전히 켜진 상태에서 4번 중첩하는 것은 그대로 유지하나, 네온이 깜빡거리는 시점에서는 효과를 1번만 중첩하였다.

1번 중첩은 효과가 상대적으로 많이 약하지만 어차피 깜빡거리는 부분이기도 하고 결과적으로 완전히 켜졌을 때의 4번 중첩은 그대로 유지했기 때문에 어느 정도 만족스러운 결과였다. 퍼포먼스가 완벽하진 않지만 상당히 향상되었기 때문이다.

<br />


# **스크린샷**
## **PC 크롬**
![](https://images.velog.io/images/drrobot409/post/3ba5f4ad-50de-4790-bf9c-4f008ad781d4/TherarebeefPC.png)

<br />

## **모바일**
_iPhone 11 pro 구동 화면, 기기 이미지는 iPhone X_
![](https://images.velog.io/images/drrobot409/post/a749c76b-3f98-4ad2-bb85-813d108c2c73/Therarebeef-iPhone.png)